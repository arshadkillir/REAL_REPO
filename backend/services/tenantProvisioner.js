const { Tenant, User } = require('../models'); const bcrypt = require('bcrypt'); async function provisionTenant({ name, plan = 'basic', seedDemo = true }){ const slug = name.toLowerCase().replace(/[^a-z0-9]+/g,'-'); const existing = await Tenant.findOne({ where:{ slug } }); if(existing) return existing; const t = await Tenant.create({ name, slug, plan, subscriptionStatus:'active', active:true }); const adminPassword = process.env.DEFAULT_ADMIN_PASSWORD || 'admin123'; const hash = await bcrypt.hash(adminPassword, 10); await User.create({ email:`admin@${slug}.example`, passwordHash: hash, name:`${name} Admin`, role:'admin', tenantId: t.id }); if(seedDemo){ const { MenuItem, Table } = require('../models'); for(let i=1;i<=6;i++) await Table.create({ name:`T${i}`, capacity:4, tenantId: t.id }); await MenuItem.bulkCreate([{ name:'Margherita Pizza', price:8.5, tenantId: t.id },{ name:'Cheeseburger', price:7, tenantId: t.id }]); } return t; } module.exports = { provisionTenant };