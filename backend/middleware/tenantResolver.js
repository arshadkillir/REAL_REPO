const { Tenant } = require('../models'); module.exports = async function tenantResolver(req,res,next){ try{ const tid = req.headers['x-tenant-id'] || req.query.tenantId || (req.body && req.body.tenantId); const slug = req.headers['x-tenant-slug'] || null; if(tid){ req.tenantId = Number(tid); return next(); } if(slug){ const t = await Tenant.findOne({ where:{ slug } }); if(t){ req.tenantId = t.id; return next(); } } req.tenantId = null; next(); }catch(e){ console.error('tenantResolver',e); req.tenantId = null; next(); } };