const { Tenant } = require('../models'); module.exports = async (req,res,next)=>{ try{ const tid = req.headers['x-tenant-id'] || req.query.tenantId; if(tid){ req.tenantId = Number(tid); return next(); } const slug = req.headers['x-tenant-slug'] || null; if(slug){ const t = await Tenant.findOne({ where:{ slug } }); if(t){ req.tenantId = t.id; return next(); } } req.tenantId = null; next(); }catch(e){ console.error(e); req.tenantId = null; next(); } };